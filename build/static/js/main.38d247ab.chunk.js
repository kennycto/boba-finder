(this["webpackJsonpboba-finder"]=this["webpackJsonpboba-finder"]||[]).push([[0],{152:function(e,t,a){e.exports=a(306)},157:function(e,t,a){},306:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(25),i=a.n(o),s=(a(157),a(27)),c=a(28),l=a(31),u=a(30),p=a(309),d=a(311),m=a(99),g=a(132),h=a.n(g),v=function(e,t,a){return{type:"AUTH_SUCCESS",idToken:e,userId:t,email:a}},f=function(){return localStorage.removeItem("token"),localStorage.removeItem("expirationDate"),localStorage.removeItem("userId"),localStorage.removeItem("email"),{type:"AUTH_LOGOUT"}},S=function(e){return function(t){setTimeout((function(){t(f())}),1e3*e)}},b=function(e){return{type:"SET_AUTH_REDIRECT_PATH",path:e}},E=a(50),L=a(308),k=a(58),O=a(15),y=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(s.a)(this,a),(e=t.call(this)).handleSubmit=function(t){e.props.auth(t.email,t.password,e.state.isSignup)},e.switchAuthModeHandler=function(){e.setState((function(e){return{isSignup:!e.isSignup}}))},e.state={isSignup:!1},e}return Object(c.a)(a,[{key:"componentWillUnmount",value:function(){"/"!==this.props.authRedirectPath&&this.props.setAuthRedirectPath("/")}},{key:"render",value:function(){var e=this.state.isSignup,t=this.props,a=t.isAuthenticated,n=t.email,o={wrapperCol:{span:16}},i=null;this.props.error&&(i=r.a.createElement("p",{className:"error"},this.props.error.message));var s=r.a.createElement("div",null,r.a.createElement("h2",null,e?"Sign up":"Sign in"),r.a.createElement(L.a,{spinning:this.props.loading},r.a.createElement(p.a,Object.assign({},{labelCol:{span:8},wrapperCol:{span:16}},{name:"basic",onFinish:this.handleSubmit}),r.a.createElement(p.a.Item,{label:"Email",name:"email",rules:[{type:"email",message:"This is not a valid email!"},{required:!0,message:"Please input your email!"}]},r.a.createElement(d.a,null)),r.a.createElement(p.a.Item,{label:"Password",name:"password",rules:[{required:!0,min:2,message:"Please input your password!"}],hasFeedback:!0},r.a.createElement(d.a,null)),r.a.createElement(p.a.Item,o,r.a.createElement(m.a,{type:"primary",htmlType:"submit"},"Submit")))),i,r.a.createElement(m.a,{type:"link",onClick:this.switchAuthModeHandler},e?"Sign in":"Sign up")),c=r.a.createElement(r.a.Fragment,null,r.a.createElement("h2",null,"Hi ".concat(n,", you're logged in!")),r.a.createElement(k.b,{to:"/"},"Home"),r.a.createElement(k.b,{to:"/logout"},"Logout"));return this.props.isAuthenticated?r.a.createElement(O.a,{to:this.props.authRedirectPath}):r.a.createElement("div",{className:"authPage"},a?c:s)}}]),a}(n.Component),C=function(e,t,a){return function(n){n(function(e,t){return{type:"AUTH_START",email:e,password:t}}(e,t));var r="AIzaSyAZDDwgLQa-2L0m1q9vLZDtThaIA1tEwfU",o="https://identitytoolkit.googleapis.com/v1/accounts:",i="".concat(o,"signUp?key=").concat(r),s="".concat(o,"signInWithPassword?key=").concat(r),c=a?i:s,l={email:e,password:t,returnSecureToken:!0};h.a.post(c,l).then((function(e){var t=new Date((new Date).getTime()+1e3*e.data.expiresIn);localStorage.setItem("token",e.data.idToken),localStorage.setItem("expirationDate",t),localStorage.setItem("userId",e.data.localId),localStorage.setItem("email",e.data.email),n(v(e.data.idToken,e.data.localId,e.data.email)),n(S(e.data.expiresIn))})).catch((function(e){console.log(e),n({type:"AUTH_FAIL",error:e.response.data.error})}))}},j=b,w=Object(E.b)((function(e){return{loading:e.auth.loading,error:e.auth.error,isAuthenticated:!!e.auth.token,email:e.auth.email,authRedirectPath:e.auth.authRedirectPath}}),{auth:C,setAuthRedirectPath:j})(y),A=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(s.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"componentDidMount",value:function(){this.props.logout()}},{key:"render",value:function(){return r.a.createElement(O.a,{to:"/auth"})}}]),a}(r.a.PureComponent),U=f,I=Object(E.b)(null,{logout:U})(A),T=a(21),_=a(150),P=a(142),R=a.n(P),M=a(312),N=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(s.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"MapMarker",key:this.props.key},r.a.createElement(M.a,{className:"icon",twoToneColor:"#eb2f96"}))}}]),a}(n.Component),D=a(310),H=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).handleSearch=function(e){var t=n.state,a=t.autocompleteService,r=t.currentUserLatLng;if(e.length>0){var o={input:e,location:r,radius:3e4};a.getQueryPredictions(o,(function(e){if(e){var t=e.map((function(e){return Object(T.a)(Object(T.a)({},e),{},{value:e.description})}));n.setState({options:t,suggestion:e})}}))}},n.onSelect=function(e){var t=n.state.map;n.state.geoCoderService.geocode({address:e},(function(a){var r=a[0].geometry.location,o=r.lat(),i=r.lng(),s={lat:o,lng:i};n.props.addSingleMarker(o,i,e,a[0].place_id),t.panTo(s),n.props.updateCurrentUserLatLng(s)}))},n.state={map:n.props.map,mapsApi:n.props.mapsApi,addSingleMarker:n.props.addSingleMarker,updateCurrentUserLatLng:n.props.updateCurrentUserLatLng,suggestions:[],options:[],currentUserLatLng:n.props.currentUserLatLng,autocompleteService:n.props.autocompleteService,geoCoderService:n.props.geoCoderService,mapsLoaded:n.props.mapsLoaded},n}return Object(c.a)(a,[{key:"componentDidUpdate",value:function(){this.setState({map:this.props.map,mapsApi:this.props.mapsApi,currentUserLatLng:this.props.currentUserLatLng,autocompleteService:this.props.autocompleteService,geoCoderService:this.props.geoCoderService,mapsLoaded:this.props.mapsLoaded})}},{key:"render",value:function(){var e=this.state.options;return r.a.createElement("div",{className:"MapAutoComplete"},r.a.createElement(D.a,{options:e,onSearch:this.handleSearch,onSelect:this.onSelect,style:{width:200},placeholder:"Enter where you at",disabled:!this.props.mapsLoaded}))}}]),a}(n.PureComponent),x=a(313),B=a(314),G=a(315),F=a(61),W=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;Object(s.a)(this,a),n=t.call(this,e);var r=e.place;return n.place=r,n.name=r.name,n.formatted_address=r.formatted_address,n.price_level=r.price_level,n.imageUrl=r.photos[0].getUrl(),n.open=r.opening_hours.isOpen(),n.rating=r.rating,n.user_ratings_total=r.user_ratings_total,n.distance=r.distance,n.duration=r.duration,n.navigate=e.navigate,n}return Object(c.a)(a,[{key:"render",value:function(){var e=this,t=r.a.createElement("span",null,"\xa0\xb7\xa0");return r.a.createElement("div",{className:"PlaceCard",onClick:function(){return e.props.navigate(e.place)}},r.a.createElement("div",{className:"header"},this.name),r.a.createElement("img",{src:this.imageUrl,alt:this.name}),r.a.createElement("div",{className:"details"},r.a.createElement("div",{className:"sub-header"},r.a.createElement("span",null,this.rating," Rating"),t,r.a.createElement("span",null,this.user_ratings_total," Reviews")),r.a.createElement("span",{className:"center"},this.formatted_address),r.a.createElement("div",{className:"multi-detail"},r.a.createElement("span",null,new Array(this.price_level).fill("$").join("")),t,this.open?r.a.createElement("div",null,r.a.createElement("span",null,"Open "),r.a.createElement(x.a,null)):r.a.createElement("div",null,r.a.createElement("span",null,"Closed "),r.a.createElement(B.a,null))),r.a.createElement("div",{className:"multi-detail footer"},r.a.createElement(G.a,{className:"icon"}),r.a.createElement("span",null,this.distance),t,r.a.createElement("span",null,this.duration))))}},{key:"computeHeaderBgColor",value:function(e){return e>=4?F.green[4]:e>=3?F.orange[4]:F.red[4]}}]),a}(n.PureComponent),q=a(316),Q=a(317),z=a(318);var K=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).addSingleMarker=function(e,t,a,r){var o=new Map;o.set(r,{lat:e,lng:t,name:a,id:r}),console.log('Added new "'.concat(a,'" Marker')),n.setState({markers:o})},n.addMarker=function(e,t,a,r){var o=function(e){var t=new Map;return e.forEach((function(e,a){t.set(a,Object(T.a)({},e))})),t}(n.state.markers);o.has(r)?(o.get(r).lat=e,o.get(r).lng=t,console.log('Updated "'.concat(a,'" Marker'))):(o.set(r,{lat:e,lng:t,name:a,id:r}),console.log('Added new "'.concat(a,'" Marker'))),n.setState({markers:o})},n.handleSearch=function(){n.setState({searchResults:[],markers:new Map});var e=n.state,t=e.mapsApi,a=e.directionService,r=e.placesService,o=e.currentUserLatLng,i={location:o,type:["restaurant","cafe","food","points_of_interest","establishment"],query:"boba, bubble, milk, tea, \u6ce2\u9738, \u5976\u8336",rankBy:t.places.RankBy.DISTANCE};r.textSearch(i,(function(e){for(var t=e.length<10?e.length:10,r=function(t){var r=e[t],i=r.formatted_address,s={origin:o,destination:i,travelMode:"DRIVING"};a.route(s,(function(e,t){if("OK"===t){var a=e.routes[0].legs[0];if(a)a.duration.value/60<30&&(n.addSearchResult(r,a.distance.text,a.duration.text),n.addMarker(r.geometry.location.lat(),r.geometry.location.lng(),r.name,r.place_id))}}))},i=0;i<t;i++)r(i)}))},n.getCurrentLocation=function(){var e=n.state.map;navigator.geolocation&&navigator.geolocation.getCurrentPosition((function(t){var a={lat:t.coords.latitude,lng:t.coords.longitude};e.panTo(a),n.updateCurrentUserLatLng(a),n.addSingleMarker(a.lat,a.lng,"You","")}))},n.updateCurrentUserLatLng=function(e){var t=n.state.mapsApi;n.setState({currentUserLatLng:new t.LatLng(e.lat,e.lng)})},n.navigate=function(e){var t=n.state.currentUserLatLng,a="".concat(t.lat().toString(),",\n\t\t\t").concat(t.lng().toString()),r=new URL("https://www.google.com/maps/dir/");r.searchParams.set("api",1),r.searchParams.set("origin",a),r.searchParams.set("destination",e.formatted_address),r.searchParams.set("travelmode","driving"),window.open(r)},n.state={pos:e.pos,mapsLoaded:!1,map:{},mapsApi:{},searchResults:[],markers:new Map,currentUserLatLng:{},autocompleteService:{},placesService:{},geoCoderService:{},directionService:{}},n}return Object(c.a)(a,[{key:"componentDidUpdate",value:function(){this.setState({pos:this.props.pos})}},{key:"render",value:function(){var e=this;return this.state.pos?r.a.createElement("div",{className:"mapContainer"},r.a.createElement("section",{className:"GoogleMapReact"},r.a.createElement("div",{className:"search"},r.a.createElement(m.a,{type:"primary",icon:r.a.createElement(Q.a,null),onClick:this.getCurrentLocation,disabled:!this.state.mapsLoaded}),r.a.createElement(H,{currentUserLatLng:this.state.currentUserLatLng,autocompleteService:this.state.autocompleteService,geoCoderService:this.state.geoCoderService,mapsApi:this.state.mapsApi,map:this.state.map,addSingleMarker:this.addSingleMarker,updateCurrentUserLatLng:this.updateCurrentUserLatLng,mapsLoaded:this.state.mapsLoaded}),r.a.createElement(m.a,{type:"primary",icon:r.a.createElement(z.a,null),onClick:this.handleSearch,disabled:!this.state.mapsLoaded},"Find Boba")),r.a.createElement(R.a,{bootstrapURLKeys:{key:"AIzaSyBwQDKEdMSdwUt9-ep22TOncRz0XtgCSQw",libraries:["places","directions"]},defaultZoom:12,defaultCenter:{lat:37.774929,lng:-122.419418},yesIWantToUseGoogleMapApiInternals:!0,onGoogleApiLoaded:function(t){var a=t.map,n=t.maps;return e.apiHasLoaded(a,n)}},Array.from(this.state.markers.values()).map((function(e){return r.a.createElement(N,{name:e.name,key:e.id,lat:e.lat,lng:e.lng})})))),r.a.createElement("div",{className:"results"},this.state.searchResults.map((function(t){return r.a.createElement(W,{place:t,key:t.id,navigate:e.navigate})})))):r.a.createElement("div",{className:"Loading"},r.a.createElement(q.a,{className:"icon-large"}))}},{key:"apiHasLoaded",value:function(e,t){var a=this,n=37.774929,r=-122.41948;if(this.setState({mapsLoaded:!0,map:e,mapsApi:t,autocompleteService:new t.places.AutocompleteService,placesService:new t.places.PlacesService(e),directionService:new t.DirectionsService,geoCoderService:new t.Geocoder}),navigator.geolocation)navigator.geolocation.getCurrentPosition((function(o){n=o.coords.latitude,r=o.coords.longitude;var i={lat:n,lng:r};e.setCenter(i),a.setState({currentUserLatLng:new t.LatLng(n,r)})}));else{var o={lat:n,lng:r};e.setCenter(o),this.setState({currentUserLatLng:new t.LatLng(n,r)})}}},{key:"addSearchResult",value:function(e,t,a){var n=[].concat(Object(_.a)(this.state.searchResults),[Object(T.a)(Object(T.a)({},e),{},{distance:t,duration:a})]);n=n.sort((function(e,t){return t.rating-e.rating})),this.setState({searchResults:n})}}]),a}(r.a.PureComponent),X=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(s.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).handleLoginButtonClicked=function(t){e.props.setAuthRedirectPath("/test"),e.props.history.push("/auth")},e}return Object(c.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"testPage"},r.a.createElement("h2",null,"Test Page"),r.a.createElement(m.a,{onClick:this.handleLoginButtonClicked},"Go to login page"))}}]),a}(r.a.PureComponent),Z=b,J=Object(O.g)(Object(E.b)((function(e){return{isAuthenticated:!!e.auth.token}}),{setAuthRedirectPath:Z})(X)),V=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).state={pos:null},n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.props.authCheckState(),navigator.geolocation&&navigator.geolocation.getCurrentPosition((function(t){var a={lat:t.coords.latitude,lng:t.coords.longitude};e.setState({pos:a})}))}},{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement(O.d,null,r.a.createElement(O.b,{exact:!0,path:"/"},r.a.createElement(K,{pos:this.state.pos})),r.a.createElement(O.b,{exact:!0,path:"/auth"},r.a.createElement(w,null)),r.a.createElement(O.b,{exact:!0,path:"/logout"},r.a.createElement(I,null)),r.a.createElement(O.b,{exact:!0,path:"/test"},r.a.createElement(J,null))))}}]),a}(r.a.PureComponent),$=function(){return function(e){var t=localStorage.getItem("token");if(t){var a=new Date(localStorage.getItem("expirationDate"));if(new Date>a)e(f());else{var n=localStorage.getItem("userId"),r=localStorage.getItem("email");e(v(t,n,r)),e(S((a-new Date)/1e3))}}else e(f())}},Y=Object(E.b)(null,{authCheckState:$})(V);a(305),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ee=a(62),te={token:null,userId:null,error:null,loading:!1,email:null},ae=function(e,t){return Object(T.a)(Object(T.a)({},e),{},{error:null,email:t.email,loading:!0})},ne=function(e,t,a){return Object(T.a)(Object(T.a)({},e),{},{token:t.idToken,userId:t.userId,email:t.email,error:null,loading:!1})},re=function(e,t){return Object(T.a)(Object(T.a)({},e),{},{error:t.error,loading:!1})},oe=function(e){return Object(T.a)(Object(T.a)({},e),{},{token:null,userId:null})},ie=function(e,t){return Object(T.a)(Object(T.a)({},e),{},{authRedirectPath:t.path})},se=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:te,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"AUTH_START":return ae(e,t);case"AUTH_SUCCESS":return ne(e,t);case"AUTH_FAIL":return re(e,t);case"AUTH_LOGOUT":return oe(e);case"SET_AUTH_REDIRECT_PATH":return ie(e,t);default:return e}},ce=a(148),le=Object(ee.c)({auth:se}),ue=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||ee.d,pe=Object(ee.e)(le,ue(Object(ee.a)(ce.a)));i.a.render(r.a.createElement(E.a,{store:pe},r.a.createElement(k.a,null,r.a.createElement(Y,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[152,1,2]]]);
//# sourceMappingURL=main.38d247ab.chunk.js.map